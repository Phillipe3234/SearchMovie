<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TVMAZE CATALOG MANAGER</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #0a1128;
            --secondary-color: #1c2b4a;
            --accent-color: #2a4d7a;
            --highlight-color: #4a7fc9;
            --text-color: #ffffff;
            --dark-bg: #050a15;
            --card-bg: #142038;
            --hover-color: #2e4c76;
            --transition-speed: 0.3s;
            --success-color: #28a745;
            --warning-color: #ffc107;
            --danger-color: #dc3545;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--dark-bg);
            color: var(--text-color);
            overflow-x: hidden;
        }

        /* Header Styles */
        header {
            background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .logo {
            font-size: 2rem;
            font-weight: bold;
            color: var(--text-color);
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
            text-align: center;
            flex: 1;
        }

        .nav-container {
            display: flex;
            align-items: center;
            gap: 2rem;
        }

        .nav-item {
            position: relative;
            cursor: pointer;
            padding: 0.5rem 1rem;
            font-size: 1.1rem;
            transition: all var(--transition-speed);
            overflow: hidden;
        }

        .nav-item::before {
            content: '';
            position: absolute;
            bottom: 0;
            left: -100%;
            width: 100%;
            height: 2px;
            background: var(--highlight-color);
            transition: left var(--transition-speed);
        }

        .nav-item:hover::before {
            left: 0;
        }

        .nav-item:hover {
            color: var(--highlight-color);
            transform: translateY(-2px);
        }

        .dropdown {
            position: relative;
            display: inline-block;
        }

        .dropdown-content {
            display: none;
            position: absolute;
            background-color: var(--card-bg);
            min-width: 400px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.5);
            z-index: 1;
            border-radius: 4px;
            overflow: hidden;
            top: 100%;
            left: 0;
        }

        .dropdown:hover .dropdown-content {
            display: block;
            animation: fadeIn 0.3s;
        }

        .dropdown-grid {
            display: grid;
            grid-template-columns: 1fr 1px 1fr;
            gap: 0;
        }

        .dropdown-column {
            padding: 10px 0;
        }

        .dropdown-divider {
            background: var(--accent-color);
            width: 1px;
            height: 100%;
        }

        .dropdown-content a {
            color: var(--text-color);
            padding: 10px 20px;
            text-decoration: none;
            display: block;
            transition: background-color var(--transition-speed);
            border: none;
            text-align: left;
            width: 100%;
            background: none;
            font-size: 0.95rem;
        }

        .dropdown-content a:hover {
            background-color: var(--hover-color);
        }

        /* Search Bar */
        .search-container {
            position: relative;
            width: 400px;
        }

        .search-box {
            width: 100%;
            padding: 0.8rem 1rem 0.8rem 3rem;
            border-radius: 25px;
            border: none;
            background-color: rgba(255, 255, 255, 0.1);
            color: var(--text-color);
            font-size: 1rem;
            outline: none;
            transition: all var(--transition-speed);
        }

        .search-box:focus {
            background-color: rgba(255, 255, 255, 0.2);
            box-shadow: 0 0 10px rgba(157, 180, 192, 0.3);
        }

        .search-icon {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-color);
            cursor: pointer;
        }

        .search-suggestions {
            display: none;
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background-color: var(--card-bg);
            border-radius: 0 0 10px 10px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.5);
            z-index: 100;
            max-height: 300px;
            overflow-y: auto;
        }

        .search-suggestions.active {
            display: block;
        }

        .search-suggestion-item {
            padding: 10px 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            cursor: pointer;
            transition: background-color var(--transition-speed);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .search-suggestion-item:hover {
            background-color: var(--hover-color);
        }

        .search-suggestion-item img {
            width: 40px;
            height: 60px;
            object-fit: cover;
            border-radius: 4px;
        }

        .search-suggestion-info {
            flex: 1;
        }

        .search-suggestion-title {
            font-weight: bold;
            margin-bottom: 4px;
        }

        .search-suggestion-year {
            font-size: 0.8rem;
            color: var(--highlight-color);
        }

        .search-history {
            display: none;
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background-color: var(--card-bg);
            border-radius: 0 0 10px 10px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.5);
            z-index: 100;
            max-height: 300px;
            overflow-y: auto;
        }

        .search-history.active {
            display: block;
        }

        .search-history-item {
            padding: 10px 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            cursor: pointer;
            transition: background-color var(--transition-speed);
        }

        .search-history-item:hover {
            background-color: var(--hover-color);
        }

        /* Home Button */
        .home-btn {
            background: none;
            border: none;
            color: var(--text-color);
            font-size: 1.5rem;
            cursor: pointer;
            transition: all var(--transition-speed);
            padding: 0.5rem;
            border-radius: 50%;
        }

        .home-btn:hover {
            color: var(--highlight-color);
            transform: scale(1.1);
            background-color: rgba(255, 255, 255, 0.1);
        }

        /* Loading Spinner */
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 2rem;
        }

        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid var(--highlight-color);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Main Content */
        .main-content {
            padding: 2rem;
            min-height: 80vh;
        }

        .section-title {
            font-size: 1.8rem;
            margin-bottom: 1.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--accent-color);
            display: inline-block;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .view-all-btn {
            background-color: var(--accent-color);
            color: var(--text-color);
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            cursor: pointer;
            transition: all var(--transition-speed);
            font-size: 0.9rem;
        }

        .view-all-btn:hover {
            background-color: var(--highlight-color);
            transform: translateY(-2px);
        }

        .carousel {
            display: flex;
            gap: 1rem;
            overflow-x: auto;
            padding: 1rem 0;
            scrollbar-width: thin;
            scrollbar-color: var(--accent-color) var(--dark-bg);
        }

        .carousel::-webkit-scrollbar {
            height: 8px;
        }

        .carousel::-webkit-scrollbar-track {
            background: var(--dark-bg);
            border-radius: 10px;
        }

        .carousel::-webkit-scrollbar-thumb {
            background: var(--accent-color);
            border-radius: 10px;
        }

        .media-card {
            min-width: 200px;
            background-color: var(--card-bg);
            border-radius: 8px;
            overflow: hidden;
            transition: all var(--transition-speed);
            cursor: pointer;
            position: relative;
        }

        .media-card:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.5);
        }

        .media-card img {
            width: 100%;
            height: 300px;
            object-fit: cover;
        }

        .media-info {
            padding: 1rem;
        }

        .media-title {
            font-size: 1.1rem;
            margin-bottom: 0.5rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .media-rating {
            color: gold;
            font-size: 0.9rem;
        }

        /* About Section */
        .about-section {
            margin-top: 3rem;
            padding: 2rem;
            background-color: var(--card-bg);
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .about-content {
            line-height: 1.6;
            font-size: 1.1rem;
        }

        .about-content p {
            margin-bottom: 1rem;
        }

        /* Category Page */
        .category-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--accent-color);
        }

        .category-title {
            font-size: 2rem;
        }

        .category-info {
            font-size: 1.2rem;
            color: var(--highlight-color);
        }

        .media-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .pagination {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-top: 2rem;
        }

        .page-btn {
            padding: 0.5rem 1rem;
            background-color: var(--secondary-color);
            border: none;
            border-radius: 4px;
            color: var(--text-color);
            cursor: pointer;
            transition: all var(--transition-speed);
        }

        .page-btn:hover {
            background-color: var(--accent-color);
            transform: translateY(-2px);
        }

        .page-btn.active {
            background-color: var(--accent-color);
        }

        /* Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }

        .modal-overlay.active {
            display: flex;
            animation: fadeIn 0.3s;
        }

        .modal-content {
            background-color: transparent;
            width: 80%;
            max-width: 900px;
            display: flex;
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }

        .modal-poster {
            flex: 0 0 40%;
        }

        .modal-poster img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .modal-info {
            flex: 1;
            background-color: var(--card-bg);
            padding: 2rem;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .modal-header {
            margin-bottom: 1.5rem;
        }

        .modal-title {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .modal-meta {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .modal-meta-item {
            background-color: var(--secondary-color);
            padding: 0.3rem 0.8rem;
            border-radius: 15px;
            font-size: 0.9rem;
        }

        .modal-duration {
            background-color: var(--secondary-color);
            padding: 0.3rem 0.8rem;
            border-radius: 15px;
            font-size: 0.9rem;
        }

        .modal-rating {
            color: gold;
            font-size: 1.2rem;
            margin-bottom: 1rem;
        }

        .modal-synopsis {
            line-height: 1.6;
            margin-bottom: 1.5rem;
            max-height: 200px;
            overflow-y: auto;
        }

        .modal-cast h3 {
            margin-bottom: 0.8rem;
            font-size: 1.2rem;
        }

        .cast-list {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .cast-member {
            background-color: var(--secondary-color);
            padding: 0.3rem 0.8rem;
            border-radius: 15px;
            font-size: 0.9rem;
        }

        .close-modal {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            color: var(--text-color);
            font-size: 1.5rem;
            cursor: pointer;
            transition: all var(--transition-speed);
            z-index: 10;
            width: 40px;
            height: 40px;
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 50%;
        }

        .close-modal:hover {
            color: var(--highlight-color);
            background-color: rgba(255, 255, 255, 0.1);
            transform: rotate(90deg);
        }

        /* Action Buttons */
        .action-buttons {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: all var(--transition-speed);
            font-size: 0.9rem;
        }

        .btn-primary {
            background-color: var(--accent-color);
            color: var(--text-color);
        }

        .btn-primary:hover {
            background-color: var(--highlight-color);
        }

        .btn-success {
            background-color: var(--success-color);
            color: white;
        }

        .btn-success:hover {
            background-color: #218838;
        }

        .btn-warning {
            background-color: var(--warning-color);
            color: black;
        }

        .btn-warning:hover {
            background-color: #e0a800;
        }

        .btn-danger {
            background-color: var(--danger-color);
            color: white;
        }

        .btn-danger:hover {
            background-color: #c82333;
        }

        /* Local Catalog Styles */
        .catalog-actions {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .sort-select {
            background-color: var(--secondary-color);
            color: var(--text-color);
            border: 1px solid var(--accent-color);
            padding: 0.5rem;
            border-radius: 4px;
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideIn {
            from { transform: translateY(-20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        /* Responsive Design */
        @media (max-width: 1200px) {
            .media-grid {
                grid-template-columns: repeat(4, 1fr);
            }
            
            .dropdown-content {
                min-width: 350px;
            }
        }

        @media (max-width: 900px) {
            .media-grid {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .modal-content {
                flex-direction: column;
                width: 90%;
            }
            
            .modal-poster {
                flex: 0 0 300px;
            }
            
            .dropdown-content {
                min-width: 300px;
            }
            
            .dropdown-grid {
                grid-template-columns: 1fr;
            }
            
            .dropdown-divider {
                display: none;
            }
        }

        @media (max-width: 768px) {
            header {
                flex-direction: column;
                gap: 1rem;
            }
            
            .nav-container {
                width: 100%;
                justify-content: space-between;
            }
            
            .search-container {
                width: 100%;
            }
            
            .media-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 480px) {
            .media-grid {
                grid-template-columns: 1fr;
            }
            
            .carousel {
                gap: 0.5rem;
            }
            
            .media-card {
                min-width: 150px;
            }
            
            .dropdown-content {
                min-width: 250px;
            }
        }

        /* Oscars Section */
        .oscar-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background: linear-gradient(45deg, #FFD700, #FFEC8B);
            color: #000;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: bold;
            z-index: 2;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }

        .gremmy-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background: linear-gradient(45deg, #1DB954, #1ed760);
            color: #000;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: bold;
            z-index: 2;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }

        .imported-badge {
            position: absolute;
            top: 10px;
            left: 10px;
            background: linear-gradient(45deg, var(--accent-color), var(--highlight-color));
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: bold;
            z-index: 2;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }
    </style>
</head>
<body>
    <!-- Header com navega√ß√£o e busca -->
    <header>
        <button class="home-btn" id="home-btn" style="display: none;">
            <i class="fas fa-home"></i>
        </button>
        <div class="logo">TVMAZE CATALOG MANAGER</div>
        <div class="nav-container">
            <div class="dropdown">
                <div class="nav-item">Filmes</div>
                <div class="dropdown-content">
                    <div class="dropdown-grid">
                        <div class="dropdown-column">
                            <a href="#" data-category="popular">üé¨ Populares</a>
                            <a href="#" data-category="top_rated">‚≠ê Melhores Avaliados</a>
                            <a href="#" data-category="28">üí• A√ß√£o</a>
                            <a href="#" data-category="12">üèîÔ∏è Aventura</a>
                            <a href="#" data-category="16">üê∞ Anima√ß√£o</a>
                            <a href="#" data-category="35">üòÇ Com√©dia</a>
                            <a href="#" data-category="80">üî´ Crime</a>
                            <a href="#" data-category="99">üé• Document√°rio</a>
                        </div>
                        <div class="dropdown-divider"></div>
                        <div class="dropdown-column">
                            <a href="#" data-category="18">üé≠ Drama</a>
                            <a href="#" data-category="10751">üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Fam√≠lia</a>
                            <a href="#" data-category="14">ü¶Ñ Fantasia</a>
                            <a href="#" data-category="36">üìú Hist√≥ria</a>
                            <a href="#" data-category="27">üëª Terror</a>
                            <a href="#" data-category="10749">üíñ Romance</a>
                            <a href="#" data-category="878">üöÄ Fic√ß√£o Cient√≠fica</a>
                        </div>
                    </div>
                </div>
            </div>
            <div class="dropdown">
                <div class="nav-item">S√©ries</div>
                <div class="dropdown-content">
                    <div class="dropdown-grid">
                        <div class="dropdown-column">
                            <a href="#" data-category="popular">üì∫ Populares</a>
                            <a href="#" data-category="top_rated">‚≠ê Melhores Avaliadas</a>
                            <a href="#" data-category="10759">üí• A√ß√£o & Aventura</a>
                            <a href="#" data-category="16">üê∞ Anima√ß√£o</a>
                            <a href="#" data-category="35">üòÇ Com√©dia</a>
                            <a href="#" data-category="80">üî´ Crime</a>
                            <a href="#" data-category="99">üé• Document√°rio</a>
                        </div>
                        <div class="dropdown-divider"></div>
                        <div class="dropdown-column">
                            <a href="#" data-category="18">üé≠ Drama</a>
                            <a href="#" data-category="10751">üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Fam√≠lia</a>
                            <a href="#" data-category="10762">üßí Kids</a>
                            <a href="#" data-category="9648">üïµÔ∏è Mist√©rio</a>
                            <a href="#" data-category="10763">üì∞ Not√≠cias</a>
                            <a href="#" data-category="10764">üéØ Reality</a>
                            <a href="#" data-category="10765">üöÄ Fic√ß√£o Cient√≠fica</a>
                        </div>
                    </div>
                </div>
            </div>
            <div class="dropdown">
                <div class="nav-item">Cat√°logo</div>
                <div class="dropdown-content">
                    <div class="dropdown-grid">
                        <div class="dropdown-column">
                            <a href="#" id="local-catalog-link">üíæ Cat√°logo Local</a>
                            <a href="#" id="sort-catalog-link"></a>
                        </div>
                    </div>
                </div>
            </div>
            <div class="search-container">
                <i class="fas fa-search search-icon" id="search-icon"></i>
                <input type="text" class="search-box" placeholder="Buscar filmes, s√©ries, atores...">
                <div class="search-suggestions" id="search-suggestions">
                    <!-- Sugest√µes de busca din√¢micas -->
                </div>
                <div class="search-history" id="search-history">
                    <!-- Hist√≥rico de busca din√¢mico -->
                </div>
            </div>
        </div>
    </header>

    <!-- Conte√∫do principal -->
    <main class="main-content">
        <!-- P√°gina inicial -->
        <div id="home-page">
            <!-- Se√ß√µes carregadas dinamicamente -->
        </div>

        <!-- P√°gina de categoria (inicialmente oculta) -->
        <div id="category-page" style="display: none;">
            <div class="category-header">
                <h1 class="category-title" id="category-title">Filmes - Populares</h1>
                <div class="category-info" id="category-info">Carregando...</div>
            </div>
            <div class="media-grid" id="category-media-grid">
                <div class="loading">
                    <div class="spinner"></div>
                </div>
            </div>
            <div class="pagination" id="pagination">
                <!-- Bot√µes de pagina√ß√£o din√¢micos -->
            </div>
        </div>

        <!-- P√°gina de resultados de busca (inicialmente oculta) -->
        <div id="search-page" style="display: none;">
            <div class="category-header">
                <h1 class="category-title" id="search-title">Resultados da Busca</h1>
                <div class="category-info" id="search-info">Carregando...</div>
            </div>
            <div class="media-grid" id="search-results">
                <div class="loading">
                    <div class="spinner"></div>
                </div>
            </div>
            <div class="pagination" id="search-pagination">
                <!-- Bot√µes de pagina√ß√£o din√¢micos -->
            </div>
        </div>

        <!-- P√°gina do cat√°logo local (inicialmente oculta) -->
        <div id="local-catalog-page" style="display: none;">
            <div class="category-header">
                <h1 class="category-title">Cat√°logo Local - S√©ries Importadas</h1>
                <div class="catalog-actions">
                    <select class="sort-select" id="sort-select">
                        <option value="rating-desc">Nota (Maior para Menor)</option>
                        <option value="rating-asc">Nota (Menor para Maior)</option>
                        <option value="name-asc">Nome (A-Z)</option>
                        <option value="name-desc">Nome (Z-A)</option>
                    </select>
                    <button class="btn btn-primary" id="apply-sort">Aplicar QuickSort</button>
                </div>
            </div>
            <div class="media-grid" id="local-catalog-grid">
                <div class="loading">
                    <div class="spinner"></div>
                </div>
            </div>
        </div>
    </main>

    <!-- Modal para detalhes da m√≠dia -->
    <div class="modal-overlay" id="media-modal">
        <div class="modal-content">
            <button class="close-modal" id="close-modal">
                <i class="fas fa-times"></i>
            </button>
            <div class="modal-poster">
                <img id="modal-poster" src="" alt="Poster da M√≠dia">
            </div>
            <div class="modal-info">
                <div class="modal-header">
                    <h2 class="modal-title" id="modal-title">T√≠tulo do Filme/S√©rie</h2>
                    <div class="modal-meta">
                        <span class="modal-meta-item" id="modal-type">Filme</span>
                        <span class="modal-meta-item" id="modal-rating-age">PG-13</span>
                        <span class="modal-meta-item" id="modal-genre">A√ß√£o, Aventura</span>
                        <span class="modal-meta-item" id="modal-year">2023</span>
                        <span class="modal-duration" id="modal-duration" style="display: none;">2h 15min</span>
                    </div>
                    <div class="modal-rating" id="modal-rating">
                        <i class="fas fa-star"></i> 8.5/10
                    </div>
                    <div class="modal-synopsis" id="modal-synopsis">
                        Sinopse do filme/s√©rie ser√° exibida aqui.
                    </div>
                    <div class="action-buttons" id="modal-actions">
                        <!-- Bot√µes de a√ß√£o din√¢micos -->
                    </div>
                </div>
                <div class="modal-cast">
                    <h3>Elenco Principal</h3>
                    <div class="cast-list" id="modal-cast">
                        <!-- Membros do elenco din√¢micos -->
                    </div>
                </div>
            </div>
        </div>
        
    </div>

    <script>
        // === CONFIGURA√á√ïES DA API (MANTIDAS COMO ESTAVAM) ===
        const API_KEY = '4071f7e25cc7586312dde97a6afdb77e';
        const BASE_URL = 'https://api.themoviedb.org/3';
        const IMAGE_BASE_URL = 'https://image.tmdb.org/t/p/w500';
        const PLACEHOLDER_IMAGE = 'https://via.placeholder.com/500x750/1c2b4a/ffffff?text=Imagem+N√£o+Dispon√≠vel';

        // === ESTRUTURAS DE DADOS CONFORME EXIGIDO ===
        class CatalogManager {
            constructor() {
                this.searchResults = []; // List: armazenar resultados de busca
                this.localCatalog = new Map(); // Map: cache local (id ‚Üí objeto)
                this.importedSeries = new Set(); // Set: controle de duplicatas
                this.genres = new Set(); // Set: g√™neros √∫nicos
            }

            // === QUICKSORT OBRIGAT√ìRIO ===
            quickSort(series, low = 0, high = series.length - 1) {
                if (low < high) {
                    const pivotIndex = this.partition(series, low, high);
                    this.quickSort(series, low, pivotIndex - 1);
                    this.quickSort(series, pivotIndex + 1, high);
                }
                return series;
            }

            partition(series, low, high) {
                const pivot = series[high].vote_average || 0;
                let i = low - 1;

                for (let j = low; j < high; j++) {
                    const currentRating = series[j].vote_average || 0;
                    // Crit√©rio: nota (decrescente), depois nome, depois id
                    if (currentRating > pivot || 
                       (currentRating === pivot && (series[j].title || series[j].name).localeCompare(series[high].title || series[high].name) < 0) ||
                       (currentRating === pivot && (series[j].title || series[j].name) === (series[high].title || series[high].name) && series[j].id < series[high].id)) {
                        i++;
                        [series[i], series[j]] = [series[j], series[i]];
                    }
                }

                [series[i + 1], series[high]] = [series[high], series[i + 1]];
                return i + 1;
            }

            // === CRUD OPERATIONS ===
            addToCatalog(media) {
                if (!this.importedSeries.has(media.id)) {
                    this.localCatalog.set(media.id, {
                        ...media,
                        importedAt: new Date().toISOString(),
                        localRating: media.vote_average
                    });
                    this.importedSeries.add(media.id);
                    
                    // Adiciona g√™neros ao Set
                    if (media.genre_ids) {
                        media.genre_ids.forEach(genreId => this.genres.add(genreId));
                    }
                    
                    this.saveToStorage();
                    return true;
                }
                return false;
            }

            removeFromCatalog(mediaId) {
                this.localCatalog.delete(mediaId);
                this.importedSeries.delete(mediaId);
                this.saveToStorage();
            }

            updateRating(mediaId, newRating) {
                const media = this.localCatalog.get(mediaId);
                if (media) {
                    media.localRating = newRating;
                    this.localCatalog.set(mediaId, media);
                    this.saveToStorage();
                }
            }

            getSortedCatalog(sortBy = 'rating-desc') {
                const seriesArray = Array.from(this.localCatalog.values());
                
                switch (sortBy) {
                    case 'rating-desc':
                        return this.quickSort([...seriesArray]);
                    case 'rating-asc':
                        return this.quickSort([...seriesArray]).reverse();
                    case 'name-asc':
                        return seriesArray.sort((a, b) => 
                            (a.title || a.name).localeCompare(b.title || b.name));
                    case 'name-desc':
                        return seriesArray.sort((a, b) => 
                            (b.title || b.name).localeCompare(a.title || a.name));
                    default:
                        return seriesArray;
                }
            }

            // === PERSIST√äNCIA (simulando MySQL) ===
            saveToStorage() {
                const data = {
                    catalog: Array.from(this.localCatalog.entries()),
                    imported: Array.from(this.importedSeries),
                    genres: Array.from(this.genres)
                };
                localStorage.setItem('tvmaze_catalog', JSON.stringify(data));
            }

            loadFromStorage() {
                const saved = localStorage.getItem('tvmaze_catalog');
                if (saved) {
                    const data = JSON.parse(saved);
                    this.localCatalog = new Map(data.catalog || []);
                    this.importedSeries = new Set(data.imported || []);
                    this.genres = new Set(data.genres || []);
                }
            }
        }

        // === ELEMENTOS DOM (MANTIDOS COMO ESTAVAM) ===
        const homePage = document.getElementById('home-page');
        const categoryPage = document.getElementById('category-page');
        const searchPage = document.getElementById('search-page');
        const localCatalogPage = document.getElementById('local-catalog-page');
        const categoryTitle = document.getElementById('category-title');
        const categoryInfo = document.getElementById('category-info');
        const categoryMediaGrid = document.getElementById('category-media-grid');
        const searchTitle = document.getElementById('search-title');    
        const searchInfo = document.getElementById('search-info');
        const searchResults = document.getElementById('search-results');
        const localCatalogGrid = document.getElementById('local-catalog-grid');
        const pagination = document.getElementById('pagination');
        const searchPagination = document.getElementById('search-pagination');
        const searchBox = document.querySelector('.search-box');
        const searchSuggestions = document.getElementById('search-suggestions');
        const searchHistory = document.getElementById('search-history');
        const searchIcon = document.getElementById('search-icon');
        const homeBtn = document.getElementById('home-btn');
        const mediaModal = document.getElementById('media-modal');
        const closeModal = document.getElementById('close-modal');
        const modalPoster = document.getElementById('modal-poster');
        const modalTitle = document.getElementById('modal-title');
        const modalType = document.getElementById('modal-type');
        const modalRatingAge = document.getElementById('modal-rating-age');
        const modalGenre = document.getElementById('modal-genre');
        const modalYear = document.getElementById('modal-year');
        const modalDuration = document.getElementById('modal-duration');
        const modalRating = document.getElementById('modal-rating');
        const modalSynopsis = document.getElementById('modal-synopsis');
        const modalCast = document.getElementById('modal-cast');
        const modalActions = document.getElementById('modal-actions');
        const sortSelect = document.getElementById('sort-select');
        const applySortBtn = document.getElementById('apply-sort');
        const localCatalogLink = document.getElementById('local-catalog-link');
        const sortCatalogLink = document.getElementById('sort-catalog-link');

        // === VARI√ÅVEIS GLOBAIS (MANTIDAS) ===
        const catalogManager = new CatalogManager();
        const CATEGORY_ENDPOINTS = {
            'filmes_popular': '/movie/popular',
            'filmes_top_rated': '/movie/top_rated',
            'series_popular': '/tv/popular',
            'series_top_rated': '/tv/top_rated',
            '28': '/discover/movie?with_genres=28',
            '12': '/discover/movie?with_genres=12',
            '16': '/discover/movie?with_genres=16',
            '35': '/discover/movie?with_genres=35',
            '80': '/discover/movie?with_genres=80',
            '99': '/discover/movie?with_genres=99',
            '18': '/discover/movie?with_genres=18',
            '10751': '/discover/movie?with_genres=10751',
            '14': '/discover/movie?with_genres=14',
            '36': '/discover/movie?with_genres=36',
            '27': '/discover/movie?with_genres=27',
            '10749': '/discover/movie?with_genres=10749',
            '878': '/discover/movie?with_genres=878',
            '10759': '/discover/tv?with_genres=10759',
            '16_tv': '/discover/tv?with_genres=16',
            '35_tv': '/discover/tv?with_genres=35',
            '80_tv': '/discover/tv?with_genres=80',
            '99_tv': '/discover/tv?with_genres=99',
            '18_tv': '/discover/tv?with_genres=18',
            '10751_tv': '/discover/tv?with_genres=10751',
            '10762': '/discover/tv?with_genres=10762',
            '9648': '/discover/tv?with_genres=9648',
            '10763': '/discover/tv?with_genres=10763',
            '10764': '/discover/tv?with_genres=10764',
            '10765': '/discover/tv?with_genres=10765'
        };

        const GENRE_NAMES = {
            '28': 'A√ß√£o', '12': 'Aventura', '16': 'Anima√ß√£o', '35': 'Com√©dia', '80': 'Crime',
            '99': 'Document√°rio', '18': 'Drama', '10751': 'Fam√≠lia', '14': 'Fantasia',
            '36': 'Hist√≥ria', '27': 'Terror', '10749': 'Romance', '878': 'Fic√ß√£o Cient√≠fica',
            '10759': 'A√ß√£o & Aventura', '10762': 'Kids', '9648': 'Mist√©rio', '10763': 'Not√≠cias',
            '10764': 'Reality', '10765': 'Fic√ß√£o Cient√≠fica'
        };

        const HOME_SECTIONS = [
            { title: 'Filmes Populares', type: 'filmes', category: 'popular', id: 'popular-movies' },
            { title: 'Filmes Melhores Avaliados', type: 'filmes', category: 'top_rated', id: 'top-rated-movies' },
            { title: 'S√©ries Populares', type: 'series', category: 'popular', id: 'popular-series' },
            { title: 'S√©ries Melhores Avaliadas', type: 'series', category: 'top_rated', id: 'top-rated-series' }
        ];

        let currentCategory = '';
        let currentType = '';
        let currentPage = 1;
        let currentSearchQuery = '';
        let currentSearchPage = 1;
        let totalResults = 0;
        let totalPages = 0;

        // === INICIALIZA√á√ÉO ===
        document.addEventListener('DOMContentLoaded', function() {
            catalogManager.loadFromStorage();
            loadHomePage();
            setupEventListeners();
            updateSearchHistory();
        });

        // === EVENT LISTENERS (MANTIDOS + NOVOS) ===
        function setupEventListeners() {
            // Listeners originais mantidos
            document.querySelectorAll('.dropdown-content a').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    if (this.id) return; // Links do cat√°logo s√£o tratados separadamente
                    const type = this.closest('.dropdown').querySelector('.nav-item').textContent.trim().toLowerCase();
                    const category = this.getAttribute('data-category');
                    showCategoryPage(type, category);
                });
            });

            // Novos listeners para o cat√°logo
            localCatalogLink.addEventListener('click', function(e) {
                e.preventDefault();
                showLocalCatalog();
            });

            sortCatalogLink.addEventListener('click', function(e) {
                e.preventDefault();
                showLocalCatalog();
            });

            applySortBtn.addEventListener('click', function() {
                loadLocalCatalog();
            });

            // Listeners originais mantidos
            searchBox.addEventListener('focus', function() {
                searchHistory.classList.add('active');
                searchSuggestions.classList.remove('active');
            });

            searchBox.addEventListener('input', function() {
                const query = this.value.trim();
                if (query.length > 2) {
                    fetchSearchSuggestions(query);
                } else {
                    searchSuggestions.classList.remove('active');
                }
            });

            searchIcon.addEventListener('click', performSearch);
            searchBox.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') performSearch();
            });

            document.addEventListener('click', function(e) {
                if (!e.target.closest('.search-container')) {
                    searchHistory.classList.remove('active');
                    searchSuggestions.classList.remove('active');
                }
            });

            homeBtn.addEventListener('click', function() {
                showHomePage();
                searchBox.value = '';
            });

            closeModal.addEventListener('click', function() {
                mediaModal.classList.remove('active');
            });

            mediaModal.addEventListener('click', function(e) {
                if (e.target === mediaModal) {
                    mediaModal.classList.remove('active');
                }
            });
        }

        // === FUN√á√ïES ORIGINAIS MANTIDAS (com pequenas adi√ß√µes) ===
        async function loadHomePage() {
            homePage.innerHTML = '<div class="loading"><div class="spinner"></div></div>';
            
            try {
                let homeContent = '';
                
                for (const section of HOME_SECTIONS) {
                    homeContent += `
                        <div class="section-header">
                            <h2 class="section-title">${section.title}</h2>
                            <button class="view-all-btn" data-type="${section.type}" data-category="${section.category}">
                                Ver Tudo
                            </button>
                        </div>
                        <div class="carousel" id="${section.id}">
                            <div class="loading">
                                <div class="spinner"></div>
                            </div>
                        </div>
                    `;
                }
                
                homeContent += `
                    <section class="about-section">
                        <h2 class="section-title">Sobre o TVMAZE CATALOG MANAGER</h2>
                        <div class="about-content">
                            <p>O TVMAZE CATALOG MANAGER √© um sistema avan√ßado de gerenciamento de cat√°logo de s√©ries e filmes 
                                que se conecta a uma base p√∫blica de dados sobre produ√ß√µes audiovisuais. Desenvolvido com as mais modernas tecnologias, 
                                nosso sistema oferece uma experi√™ncia √∫nica para os amantes de cinema e televis√£o.</p>
                            <p>Com uma interface intuitiva e recursos avan√ßados de busca, o TVMAZE permite que voc√™ explore milhares de t√≠tulos, 
                                descubra novas produ√ß√µes e mantenha-se atualizado sobre o universo do entretenimento.</p>
                            <p>Nossa plataforma implementa rigorosamente os princ√≠pios de Programa√ß√£o Orientada a Objetos, garantindo um c√≥digo limpo,
                                 organizado e de f√°cil manuten√ß√£o. Atrav√©s de integra√ß√£o com APIs p√∫blicas, oferecemos informa√ß√µes atualizadas sobre s√©ries, 
                                 epis√≥dios, elenco e muito mais.</p>
                        </div>
                        <div class="last-update">
                            DEVs da p√°gina: <span id="lastUpdate"></span>
                            <p>&copy; Kauan | Lucas | Phillipe | Rony 
                        </div>
                    </section>
                `;
               

                
                homePage.innerHTML = homeContent;
                
                document.querySelectorAll('.view-all-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const type = this.getAttribute('data-type');
                        const category = this.getAttribute('data-category');
                        showCategoryPage(type, category);
                    });
                });
                
                for (const section of HOME_SECTIONS) {
                    await loadHomeSection(section);
                }
            } catch (error) {
                console.error('Error loading home page:', error);
                homePage.innerHTML = '<p>Erro ao carregar a p√°gina inicial</p>';
            }
        }

        // === FUN√á√ïES DO CAT√ÅLOGO LOCAL ===
        function showLocalCatalog() {
            homePage.style.display = 'none';
            categoryPage.style.display = 'none';
            searchPage.style.display = 'none';
            localCatalogPage.style.display = 'block';
            homeBtn.style.display = 'block';
            searchBox.value = '';
            
            loadLocalCatalog();
        }

        function loadLocalCatalog() {
            const sortBy = sortSelect.value;
            const sortedMedia = catalogManager.getSortedCatalog(sortBy);
            
            localCatalogGrid.innerHTML = '';
            
            if (sortedMedia.length === 0) {
                localCatalogGrid.innerHTML = '<p>Nenhuma m√≠dia no cat√°logo local. Importe algumas s√©ries ou filmes!</p>';
                return;
            }
            
            sortedMedia.forEach(media => {
                const card = createMediaCard(media, '', true);
                localCatalogGrid.appendChild(card);
            });
        }

        // === MODIFICA√á√ÉO NA CRIA√á√ÉO DO CARD ===
        function createMediaCard(media, category, isLocal = false) {
            const card = document.createElement('div');
            card.className = 'media-card';
            card.setAttribute('data-id', media.id);
            card.setAttribute('data-type', media.media_type || (media.title ? 'movie' : 'tv'));
            
            const posterPath = media.poster_path ? IMAGE_BASE_URL + media.poster_path : PLACEHOLDER_IMAGE;
            const title = media.title || media.name;
            const rating = media.vote_average ? media.vote_average.toFixed(1) : 'N/A';
            const year = media.release_date ? media.release_date.substring(0, 4) : 
                         media.first_air_date ? media.first_air_date.substring(0, 4) : 'N/A';
            
            let badge = '';
            if (media.vote_average >= 8.5) {
                badge = '<div class="oscar-badge">üèÜ OSCAR</div>';
            } else if (media.vote_average >= 7.5) {
                badge = '<div class="gremmy-badge">üéØ GREMMY</div>';
            }
            
            if (isLocal) {
                badge += '<div class="imported-badge">üíæ LOCAL</div>';
            }
            
            card.innerHTML = `
                ${badge}
                <img src="${posterPath}" alt="${title}" onerror="this.src='${PLACEHOLDER_IMAGE}'">
                <div class="media-info">
                    <h3 class="media-title">${title}</h3>
                    <div class="media-rating">
                        <i class="fas fa-star"></i> ${rating}/10
                    </div>
                </div>
            `;
            
            card.addEventListener('click', function() {
                showMediaDetails(media, isLocal);
            });
            
            return card;
        }

        // === MODIFICA√á√ÉO NO MODAL ===
        async function showMediaDetails(media, isLocal = false) {
            const mediaId = media.id;
            const mediaType = media.media_type || (media.title ? 'movie' : 'tv');
            
            // Estado de carregamento
            modalPoster.src = '';
            modalTitle.textContent = 'Carregando...';
            modalType.textContent = '';
            modalRatingAge.textContent = '';
            modalGenre.textContent = '';
            modalYear.textContent = '';
            modalDuration.textContent = '';
            modalDuration.style.display = 'none';
            modalRating.innerHTML = '<i class="fas fa-star"></i> Carregando...';
            modalSynopsis.textContent = 'Carregando sinopse...';
            modalCast.innerHTML = '';
            modalActions.innerHTML = '';
            
            mediaModal.classList.add('active');
            
            try {
                const mediaDetails = await fetchMediaDetails(mediaId, mediaType);
                const cast = await fetchMediaCast(mediaId, mediaType);
                
                const posterPath = mediaDetails.poster_path ? 
                    IMAGE_BASE_URL + mediaDetails.poster_path : PLACEHOLDER_IMAGE;
                
                modalPoster.src = posterPath;
                modalTitle.textContent = mediaDetails.title || mediaDetails.name;
                modalType.textContent = mediaType === 'movie' ? 'Filme' : 'S√©rie';
                modalRatingAge.textContent = mediaDetails.adult ? '18+' : 'Livre';
                modalGenre.textContent = mediaDetails.genres ? 
                    mediaDetails.genres.map(genre => genre.name).join(', ') : 'N/A';
                modalYear.textContent = mediaDetails.release_date ? 
                    mediaDetails.release_date.substring(0, 4) : 
                    mediaDetails.first_air_date ? mediaDetails.first_air_date.substring(0, 4) : 'N/A';
                
                if (mediaType === 'movie' && mediaDetails.runtime && mediaDetails.runtime > 0) {
                    const formattedDuration = formatDuration(mediaDetails.runtime);
                    if (formattedDuration) {
                        modalDuration.textContent = formattedDuration;
                        modalDuration.style.display = 'inline-block';
                    }
                }
                
                modalRating.innerHTML = `<i class="fas fa-star"></i> ${mediaDetails.vote_average ? mediaDetails.vote_average.toFixed(1) : 'N/A'}/10`;
                modalSynopsis.textContent = mediaDetails.overview || 'Sinopse n√£o dispon√≠vel.';
                
                // Elenco
                modalCast.innerHTML = '';
                if (cast.length > 0) {
                    cast.forEach(actor => {
                        const castMember = document.createElement('span');
                        castMember.className = 'cast-member';
                        castMember.textContent = actor.name;
                        modalCast.appendChild(castMember);
                    });
                } else {
                    modalCast.innerHTML = '<span class="cast-member">Elenco n√£o dispon√≠vel</span>';
                }
                
                // Bot√µes de a√ß√£o
                const alreadyImported = catalogManager.importedSeries.has(mediaDetails.id);
                
                if (!alreadyImported) {
                    const importBtn = document.createElement('button');
                    importBtn.className = 'btn btn-success';
                    importBtn.innerHTML = '<i class="fas fa-download"></i> Importar para Cat√°logo';
                    importBtn.addEventListener('click', function() {
                        if (catalogManager.addToCatalog(mediaDetails)) {
                            alert('M√≠dia importada com sucesso para o cat√°logo local!');
                            modalActions.innerHTML = '<button class="btn btn-danger" id="remove-from-catalog"><i class="fas fa-trash"></i> Remover do Cat√°logo</button>';
                            document.getElementById('remove-from-catalog').addEventListener('click', function() {
                                catalogManager.removeFromCatalog(mediaDetails.id);
                                alert('M√≠dia removida do cat√°logo local!');
                                mediaModal.classList.remove('active');
                            });
                        } else {
                            alert('Esta m√≠dia j√° est√° no cat√°logo local!');
                        }
                    });
                    modalActions.appendChild(importBtn);
                } else {
                    const removeBtn = document.createElement('button');
                    removeBtn.className = 'btn btn-danger';
                    removeBtn.innerHTML = '<i class="fas fa-trash"></i> Remover do Cat√°logo';
                    removeBtn.addEventListener('click', function() {
                        catalogManager.removeFromCatalog(mediaDetails.id);
                        alert('M√≠dia removida do cat√°logo local!');
                        mediaModal.classList.remove('active');
                    });
                    modalActions.appendChild(removeBtn);
                }
                
            } catch (error) {
                console.error('Error loading media details:', error);
                modalTitle.textContent = 'Erro ao carregar detalhes';
                modalSynopsis.textContent = 'N√£o foi poss√≠vel carregar os detalhes deste t√≠tulo.';
            }
        }

        // === FUN√á√ïES ORIGINAIS MANTIDAS (sem altera√ß√µes) ===
        async function loadHomeSection(section) {
            const carousel = document.getElementById(section.id);
            
            try {
                let mediaItems = [];
                
                const typeKey = section.type === 'filmes' ? 'filmes' : 'series';
                let endpoint;
                
                if (section.category === 'popular' || section.category === 'top_rated') {
                    endpoint = CATEGORY_ENDPOINTS[`${typeKey}_${section.category}`];
                } else {
                    const categoryKey = section.type === 'filmes' ? section.category : `${section.category}_tv`;
                    endpoint = CATEGORY_ENDPOINTS[categoryKey] || CATEGORY_ENDPOINTS[section.category];
                }
                
                if (endpoint) {
                    const data = await fetchFromAPI(endpoint);
                    mediaItems = data.results ? data.results.slice(0, 24) : [];
                }
                
                if (mediaItems.length === 0) {
                    carousel.innerHTML = '<p>Nenhum conte√∫do dispon√≠vel</p>';
                } else {
                    loadCarousel(carousel, mediaItems, section.category);
                }
            } catch (error) {
                console.error(`Error loading section ${section.id}:`, error);
                carousel.innerHTML = '<p>Erro ao carregar conte√∫do</p>';
            }
        }

        function loadCarousel(carousel, mediaItems, category) {
            carousel.innerHTML = '';
            
            if (!mediaItems || mediaItems.length === 0) {
                carousel.innerHTML = '<p>Nenhum resultado encontrado</p>';
                return;
            }
            
            mediaItems.forEach(media => {
                const card = createMediaCard(media, category);
                carousel.appendChild(card);
            });
        }

        async function fetchFromAPI(endpoint, page = 1) {
            try {
                let url;
                if (endpoint.includes('?')) {
                    url = `${BASE_URL}${endpoint}&api_key=${API_KEY}&page=${page}&language=pt-BR`;
                } else {
                    url = `${BASE_URL}${endpoint}?api_key=${API_KEY}&page=${page}&language=pt-BR`;
                }
                
                const response = await fetch(url);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                return await response.json();
            } catch (error) {
                console.error(`Error fetching from ${endpoint}:`, error);
                throw error;
            }
        }

        async function fetchSearchResults(query, page = 1) {
            try {
                const url = `${BASE_URL}/search/multi?api_key=${API_KEY}&query=${encodeURIComponent(query)}&page=${page}&language=pt-BR`;
                const response = await fetch(url);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                return await response.json();
            } catch (error) {
                console.error('Error fetching search results:', error);
                throw error;
            }
        }

        async function fetchSearchSuggestions(query) {
            try {
                const data = await fetchSearchResults(query, 1);
                showSearchSuggestions(data.results.slice(0, 5));
            } catch (error) {
                console.error('Error fetching search suggestions:', error);
            }
        }

        async function fetchMediaDetails(id, type) {
            try {
                const endpoint = type === 'movie' ? `/movie/${id}` : `/tv/${id}`;
                return await fetchFromAPI(endpoint);
            } catch (error) {
                console.error('Error fetching media details:', error);
                throw error;
            }
        }

        async function fetchMediaCast(id, type) {
            try {
                const endpoint = type === 'movie' ? `/movie/${id}/credits` : `/tv/${id}/credits`;
                const data = await fetchFromAPI(endpoint);
                return data.cast ? data.cast.slice(0, 10) : [];
            } catch (error) {
                console.error('Error fetching media cast:', error);
                return [];
            }
        }

        function showCategoryPage(type, category) {
            homePage.style.display = 'none';
            categoryPage.style.display = 'block';
            searchPage.style.display = 'none';
            localCatalogPage.style.display = 'none';
            homeBtn.style.display = 'block';
            searchBox.value = '';
            
            currentType = type;
            currentCategory = category;
            currentPage = 1;
            
            const typeText = type === 'filmes' ? 'Filmes' : 'S√©ries';
            const categoryText = getCategoryDisplayName(category);
            
            categoryTitle.textContent = `${typeText} - ${categoryText}`;
            categoryInfo.textContent = 'Carregando...';
            
            loadCategoryMedia();
        }

        function getCategoryDisplayName(category) {
            const categoryNames = {
                'popular': 'Populares',
                'top_rated': 'Melhores Avaliados'
            };
            
            return categoryNames[category] || GENRE_NAMES[category] || category;
        }

        function formatDuration(minutes) {
            if (!minutes || minutes === 0) return null;
            
            const hours = Math.floor(minutes / 60);
            const mins = minutes % 60;
            
            if (hours === 0) {
                return `${mins}min`;
            } else if (mins === 0) {
                return `${hours}h`;
            } else {
                return `${hours}h ${mins}min`;
            }
        }

        async function loadCategoryMedia() {
            categoryMediaGrid.innerHTML = '<div class="loading"><div class="spinner"></div></div>';
            
            try {
                let data;
                
                const typeKey = currentType === 'filmes' ? 'filmes' : 'series';
                let endpoint;
                
                if (currentCategory === 'popular' || currentCategory === 'top_rated') {
                    endpoint = CATEGORY_ENDPOINTS[`${typeKey}_${currentCategory}`];
                } else {
                    const categoryKey = currentType === 'filmes' ? currentCategory : `${currentCategory}_tv`;
                    endpoint = CATEGORY_ENDPOINTS[categoryKey] || CATEGORY_ENDPOINTS[currentCategory];
                }
                
                if (!endpoint) {
                    throw new Error('Categoria n√£o encontrada');
                }
                
                data = await fetchFromAPI(endpoint, currentPage);
                
                const resultsToShow = data.results || [];
                totalResults = data.total_results || 0;
                
                const itemsPerPage = 24;
                const startItem = (currentPage - 1) * itemsPerPage + 1;
                const endItem = Math.min(currentPage * itemsPerPage, totalResults);
                categoryInfo.textContent = `Exibindo ${startItem}-${endItem} de ${totalResults} resultados`;
                
                categoryMediaGrid.innerHTML = '';
                
                if (resultsToShow.length === 0) {
                    categoryMediaGrid.innerHTML = '<p>Nenhum resultado encontrado para esta categoria</p>';
                    pagination.innerHTML = '';
                    return;
                }
                
                const itemsToDisplay = resultsToShow.slice(0, 24);
                
                itemsToDisplay.forEach(media => {
                    const card = createMediaCard(media, currentCategory);
                    categoryMediaGrid.appendChild(card);
                });
                
                totalPages = Math.min(Math.ceil(totalResults / itemsPerPage), 24);
                createPagination();
                
            } catch (error) {
                console.error('Error loading category media:', error);
                categoryMediaGrid.innerHTML = '<p>Erro ao carregar resultados: ' + error.message + '</p>';
            }
        }

        function createPagination() {
            pagination.innerHTML = '';
            
            if (totalPages <= 1) return;
            
            if (currentPage > 1) {
                const prevButton = document.createElement('button');
                prevButton.className = 'page-btn';
                prevButton.textContent = 'Anterior';
                prevButton.addEventListener('click', function() {
                    currentPage = currentPage - 1;
                    loadCategoryMedia();
                });
                pagination.appendChild(prevButton);
            }
            
            const maxVisiblePages = 5;
            let startPage = Math.max(1, currentPage - Math.floor(maxVisiblePages / 2));
            let endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);
            
            if (endPage - startPage + 1 < maxVisiblePages) {
                startPage = Math.max(1, endPage - maxVisiblePages + 1);
            }
            
            for (let i = startPage; i <= endPage; i++) {
                const pageButton = document.createElement('button');
                pageButton.className = 'page-btn';
                if (i === currentPage) {
                    pageButton.classList.add('active');
                }
                pageButton.textContent = i;
                pageButton.addEventListener('click', function() {
                    currentPage = i;
                    loadCategoryMedia();
                });
                pagination.appendChild(pageButton);
            }
            
            if (currentPage < totalPages) {
                const nextButton = document.createElement('button');
                nextButton.className = 'page-btn';
                nextButton.textContent = 'Pr√≥xima';
                nextButton.addEventListener('click', function() {
                    currentPage = currentPage + 1;
                    loadCategoryMedia();
                });
                pagination.appendChild(nextButton);
            }
        }

        async function performSearch() {
            const query = searchBox.value.trim();
            if (!query) return;
            
            addToSearchHistory(query);
            
            homePage.style.display = 'none';
            categoryPage.style.display = 'none';
            searchPage.style.display = 'block';
            localCatalogPage.style.display = 'none';
            homeBtn.style.display = 'block';
            
            currentSearchQuery = query;
            currentSearchPage = 1;
            
            searchTitle.textContent = `Resultados para: "${query}"`;
            searchInfo.textContent = 'Carregando...';
            
            await loadSearchResults();
        }

        async function loadSearchResults() {
            searchResults.innerHTML = '<div class="loading"><div class="spinner"></div></div>';
            
            try {
                const searchData = await fetchSearchResults(currentSearchQuery, currentSearchPage);
                const allMediaItems = searchData.results ? searchData.results.filter(item => 
                    (item.media_type === 'movie' || item.media_type === 'tv') && (item.poster_path || item.backdrop_path)
                ) : [];
                
                const mediaItems = allMediaItems.slice(0, 24);
                
                const totalResults = searchData.total_results || 0;
                const itemsPerPage = 24;
                const startItem = (currentSearchPage - 1) * itemsPerPage + 1;
                const endItem = Math.min(currentSearchPage * itemsPerPage, totalResults);
                searchInfo.textContent = `Exibindo ${startItem}-${endItem} de ${totalResults} resultados`;
                
                searchResults.innerHTML = '';
                
                if (mediaItems.length === 0) {
                    searchResults.innerHTML = '<p>Nenhum resultado encontrado</p>';
                    searchPagination.innerHTML = '';
                    return;
                }
                
                mediaItems.forEach(media => {
                    const card = createMediaCard(media);
                    searchResults.appendChild(card);
                });
                
                const totalPages = Math.min(searchData.total_pages || 1, 24);
                createSearchPagination(totalPages);
            } catch (error) {
                console.error('Error loading search results:', error);
                searchResults.innerHTML = '<p>Erro ao carregar resultados</p>';
            }
        }

        function createSearchPagination(totalPages) {
            searchPagination.innerHTML = '';
            
            if (totalPages <= 1) return;
            
            if (currentSearchPage > 1) {
                const prevButton = document.createElement('button');
                prevButton.className = 'page-btn';
                prevButton.textContent = 'Anterior';
                prevButton.addEventListener('click', function() {
                    currentSearchPage = currentSearchPage - 1;
                    loadSearchResults();
                });
                searchPagination.appendChild(prevButton);
            }
            
            const maxVisiblePages = 5;
            let startPage = Math.max(1, currentSearchPage - Math.floor(maxVisiblePages / 2));
            let endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);
            
            if (endPage - startPage + 1 < maxVisiblePages) {
                startPage = Math.max(1, endPage - maxVisiblePages + 1);
            }
            
            for (let i = startPage; i <= endPage; i++) {
                const pageButton = document.createElement('button');
                pageButton.className = 'page-btn';
                if (i === currentSearchPage) {
                    pageButton.classList.add('active');
                }
                pageButton.textContent = i;
                pageButton.addEventListener('click', function() {
                    currentSearchPage = i;
                    loadSearchResults();
                });
                searchPagination.appendChild(pageButton);
            }
            
            if (currentSearchPage < totalPages) {
                const nextButton = document.createElement('button');
                nextButton.className = 'page-btn';
                nextButton.textContent = 'Pr√≥xima';
                nextButton.addEventListener('click', function() {
                    currentSearchPage = currentSearchPage + 1;
                    loadSearchResults();
                });
                searchPagination.appendChild(nextButton);
            }
        }

        function showSearchSuggestions(results) {
            searchSuggestions.innerHTML = '';
            
            if (!results || results.length === 0) {
                searchSuggestions.classList.remove('active');
                return;
            }
            
            results.forEach(item => {
                if ((item.media_type === 'movie' || item.media_type === 'tv') && (item.poster_path || item.backdrop_path)) {
                    const suggestionItem = document.createElement('div');
                    suggestionItem.className = 'search-suggestion-item';
                    
                    const posterPath = item.poster_path ? IMAGE_BASE_URL + item.poster_path : PLACEHOLDER_IMAGE;
                    const title = item.title || item.name;
                    const year = item.release_date ? item.release_date.substring(0, 4) : 
                                 item.first_air_date ? item.first_air_date.substring(0, 4) : 'N/A';
                    
                    suggestionItem.innerHTML = `
                        <img src="${posterPath}" alt="${title}" onerror="this.src='${PLACEHOLDER_IMAGE}'">
                        <div class="search-suggestion-info">
                            <div class="search-suggestion-title">${title}</div>
                            <div class="search-suggestion-year">${year} ‚Ä¢ ${item.media_type === 'movie' ? 'Filme' : 'S√©rie'}</div>
                        </div>
                    `;
                    
                    suggestionItem.addEventListener('click', function() {
                        searchBox.value = title;
                        searchSuggestions.classList.remove('active');
                        performSearch();
                    });
                    
                    searchSuggestions.appendChild(suggestionItem);
                }
            });
            
            searchSuggestions.classList.add('active');
            searchHistory.classList.remove('active');
        }

        function addToSearchHistory(query) {
            let history = JSON.parse(localStorage.getItem('searchHistory') || '[]');
            
            history = history.filter(item => item !== query);
            history.unshift(query);
            history = history.slice(0, 10);
            
            localStorage.setItem('searchHistory', JSON.stringify(history));
            updateSearchHistory();
        }

        function updateSearchHistory() {
            const history = JSON.parse(localStorage.getItem('searchHistory') || '[]');
            
            searchHistory.innerHTML = '';
            
            if (history.length === 0) {
                const noHistory = document.createElement('div');
                noHistory.className = 'search-history-item';
                noHistory.textContent = 'Nenhuma busca recente';
                searchHistory.appendChild(noHistory);
            } else {
                history.forEach(term => {
                    const historyItem = document.createElement('div');
                    historyItem.className = 'search-history-item';
                    historyItem.textContent = term;
                    historyItem.addEventListener('click', function() {
                        searchBox.value = term;
                        searchHistory.classList.remove('active');
                        performSearch();
                    });
                    searchHistory.appendChild(historyItem);
                });
            }
        }

        function showHomePage() {
            homePage.style.display = 'block';
            categoryPage.style.display = 'none';
            searchPage.style.display = 'none';
            localCatalogPage.style.display = 'none';
            homeBtn.style.display = 'none';
            searchBox.value = '';
        }

        function showError(element, message) {
            element.innerHTML = `<p>${message}</p>`;
        }
    </script>
    
</body>
</html>